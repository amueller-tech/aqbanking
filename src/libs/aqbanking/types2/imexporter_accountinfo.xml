<?xml?>

<tm2>
  <type id="AB_IMEXPORTER_ACCOUNTINFO" type="pointer">
    <descr>
    </descr>

    <lang id="c">
      <identifier>AB_IMEXPORTER_ACCOUNTINFO</identifier>
      <prefix>AB_ImExporterAccountInfo</prefix>
      
      <baseFileName>imexporter_accountInfo</baseFileName>
      
      <flags>
        with_db
        with_xml
        with_list1
        with_list2
        with_refcount
        with_hash
      </flags>
      
      <headers>
        <header type="sys" loc="pre">aqbanking/error.h</header>
        <header type="sys" loc="pre">gwenhywfar/types.h</header>
        <header type="sys" loc="pre">gwenhywfar/gwentime.h</header>

        <header type="sys" loc="post">aqbanking/transaction.h</header>
        <header type="sys" loc="post">aqbanking/accstatus.h</header>
        <header type="sys" loc="post">aqbanking/document.h</header>
        <header type="sys" loc="post">aqbanking/account.h</header>
      </headers>



      <inlines>

        <inline loc="end" access="public">
          <typeFlagsMask>with_list2</typeFlagsMask>
          <typeFlagsValue>with_list2</typeFlagsValue>
          <content>
             $(api) int $(struct_prefix)_List2_freeAll($(struct_type)_LIST2 *tl);
          </content>
        </inline>

        <inline loc="code">
          <typeFlagsMask>with_list2</typeFlagsMask>
          <typeFlagsValue>with_list2</typeFlagsValue>
          <content>

             static $(struct_type) *$(struct_prefix)_List2__freeAll_cb($(struct_type) *t, void *user_data) {  \n
               $(struct_prefix)_free(t);                                                                      \n
               return NULL;                                                                                   \n
             }                                                                                                \n
                                                                                                              \n
                                                                                                              \n
             int $(struct_prefix)_List2_freeAll($(struct_type)_LIST2 *tl) {                                   \n
               if (tl) {                                                                                      \n
                 $(struct_prefix)_List2_ForEach(tl, $(struct_prefix)_List2__freeAll_cb, NULL);                \n
                 $(struct_prefix)_List2_free(tl);                                                             \n
               }                                                                                              \n
               else {                                                                                         \n
                 DBG_ERROR(AQBANKING_LOGDOMAIN, "List missing");                                              \n
                 return GWEN_ERROR_INVALID;                                                                   \n
               }                                                                                              \n
               return 0;                                                                                      \n
             }                                                                                               
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) AB_TRANSACTION *$(struct_prefix)_GetFirstTransaction(const $(struct_type) *t, int ty, int cmd);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_TRANSACTION *$(struct_prefix)_GetFirstTransaction(const $(struct_type) *st, int ty, int cmd) { \n
               assert(st);                                                                                     \n
               if (st->transactionList)                                                                        \n
                 return AB_Transaction_List_FindFirstByType(st->transactionList, ty, cmd);                     \n
               return NULL;                                                                                    \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) void $(struct_prefix)_AddTransaction($(struct_type) *st, AB_TRANSACTION *t);
          </content>
        </inline>

        <inline loc="code">
          <content>
             void $(struct_prefix)_AddTransaction($(struct_type) *st, AB_TRANSACTION *t) {                    \n
               assert(st);                                                                                    \n
               if (NULL==st->transactionList)                                                                 \n
                 st->transactionList=AB_Transaction_List_new();                                               \n
               AB_Transaction_List_Add(t, st->transactionList);                                               \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) int $(struct_prefix)_GetTransactionCount(const $(struct_type) *t, int ty, int cmd);
          </content>
        </inline>

        <inline loc="code">
          <content>
             int $(struct_prefix)_GetTransactionCount(const $(struct_type) *st, int ty, int cmd) {           \n
               assert(st);                                                                                   \n
               if (st->transactionList)                                                                      \n
                 return AB_Transaction_List_CountByType(st->transactionList, ty, cmd);                       \n
               return 0;                                                                                     \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) AB_ACCOUNT_STATUS *$(struct_prefix)_GetFirstAccountStatus(const $(struct_type) *as);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_ACCOUNT_STATUS *$(struct_prefix)_GetFirstAccountStatus(const $(struct_type) *as) {          \n
               assert(as);                                                                                  \n
               if (as->accountStatusList)                                                                   \n
                 return AB_AccountStatus_List_First(as->accountStatusList);                                 \n
               return NULL;                                                                                 \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) void $(struct_prefix)_AddAccountStatus($(struct_type) *st, AB_ACCOUNT_STATUS *as);
          </content>
        </inline>

        <inline loc="code">
          <content>
             void $(struct_prefix)_AddAccountStatus($(struct_type) *st, AB_ACCOUNT_STATUS *as) {           \n
               assert(as);                                                                                 \n
               if (NULL==st->accountStatusList)                                                            \n
                 st->accountStatusList=AB_AccountStatus_List_new();                                        \n
               AB_AccountStatus_List_Add(as, st->accountStatusList);                                       \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) AB_DOCUMENT *$(struct_prefix)_GetFirstEStatement(const $(struct_type) *st);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_DOCUMENT *$(struct_prefix)_GetFirstEStatement(const $(struct_type) *st) {                 \n
               assert(st);                                                                                \n
               if (st->eStatementList)                                                                    \n
                 return AB_Document_List_First(st->eStatementList);                                       \n
               return NULL;                                                                               \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) void $(struct_prefix)_AddEStatement($(struct_type) *st, AB_DOCUMENT *d);
          </content>
        </inline>

        <inline loc="code">
          <content>
             void $(struct_prefix)_AddEStatement($(struct_type) *st, AB_DOCUMENT *d) {                   \n
               assert(d);                                                                                \n
               if (NULL==st->eStatementList)                                                             \n
                 st->eStatementList=AB_Document_List_new();                                              \n
               AB_Document_List_Add(d, st->eStatementList);                                              \n
             }                                                                                          
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             /** \n
              * This function clears the account info (e.g. removes all transactions etc). \n
              */ \n
             $(api) void $(struct_prefix)_Clear($(struct_type) *st);
          </content>
        </inline>

        <inline loc="code">
          <content>
             void $(struct_prefix)_Clear($(struct_type) *st) {                                          \n
               assert(st);                                                                              \n
               if (st->transactionList)                                                                 \n
                 AB_Transaction_List_Clear(st->transactionList);                                        \n
               if (st->accountStatusList)                                                               \n
                 AB_AccountStatus_List_Clear(st->accountStatusList);                                    \n
               if (st->eStatementList)                                                                  \n
                 AB_Document_List_Clear(st->eStatementList);                                            \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) void $(struct_prefix)_FillFromAccountSpec($(struct_type) *st, const AB_ACCOUNT_SPEC *a);
          </content>
        </inline>

        <inline loc="code">
          <content>
             void $(struct_prefix)_FillFromAccountSpec($(struct_type) *st, const AB_ACCOUNT_SPEC *a) {  \n
               const char *s;                                                                           \n
               AB_ACCOUNT_TYPE at;                                                                      \n
                                                                                                        \n
               assert(st);                                                                              \n
               assert(a);                                                                               \n
                                                                                                        \n
               s=AB_AccountSpec_GetBankCode(a);                                                         \n
               $(struct_prefix)_SetBankCode(st, s);                                                     \n
                                                                                                        \n
               s=AB_AccountSpec_GetAccountNumber(a);                                                    \n
               $(struct_prefix)_SetAccountNumber(st, s);                                                \n
                                                                                                        \n
               s=AB_AccountSpec_GetSubAccountNumber(a);                                                 \n
               $(struct_prefix)_SetSubAccountId(st, s);                                                 \n
                                                                                                        \n
               $(struct_prefix)_SetAccountId(st, AB_AccountSpec_GetUniqueId(a));                        \n
                                                                                                        \n
               s=AB_AccountSpec_GetAccountName(a);                                                      \n
               $(struct_prefix)_SetAccountName(st, s);                                                  \n
                                                                                                        \n
               s=AB_AccountSpec_GetIban(a);                                                             \n
               $(struct_prefix)_SetIban(st, s);                                                         \n
                                                                                                        \n
               s=AB_AccountSpec_GetBic(a);                                                              \n
               $(struct_prefix)_SetBic(st, s);                                                          \n
                                                                                                        \n
               s=AB_AccountSpec_GetCurrency(a);                                                         \n
               $(struct_prefix)_SetCurrency(st, s);                                                     \n
                                                                                                        \n
               s=AB_AccountSpec_GetOwnerName(a);                                                        \n
               $(struct_prefix)_SetOwner(st, s);                                                        \n
                                                                                                        \n
               at=AB_AccountSpec_GetType(a);                                                            \n
               $(struct_prefix)_SetAccountType(st, at);                                                 \n
             }
          </content>
        </inline>


        <inline loc="end" access="public">
          <content>
             $(api) void $(struct_prefix)_FillFromTransaction($(struct_type) *st, const AB_TRANSACTION *t);
          </content>
        </inline>

        <inline loc="code">
          <content>
             void $(struct_prefix)_FillFromTransaction($(struct_type) *st, const AB_TRANSACTION *t) {   \n
               const char *s;                                                                           \n
                                                                                                        \n
               assert(st);                                                                              \n
               assert(t);                                                                               \n
                                                                                                        \n
               s=AB_Transaction_GetLocalBankCode(t);                                                    \n
               $(struct_prefix)_SetBankCode(st, s);                                                     \n
                                                                                                        \n
               s=AB_Transaction_GetLocalAccountNumber(t);                                               \n
               $(struct_prefix)_SetAccountNumber(st, s);                                                \n
                                                                                                        \n
               s=AB_Transaction_GetLocalSuffix(t);                                                      \n
               $(struct_prefix)_SetSubAccountId(st, s);                                                 \n
                                                                                                        \n
               s=AB_Transaction_GetLocalIban(t);                                                        \n
               $(struct_prefix)_SetIban(st, s);                                                         \n
                                                                                                        \n
               s=AB_Transaction_GetLocalBic(t);                                                         \n
               $(struct_prefix)_SetBic(st, s);                                                          \n
                                                                                                        \n
               s=AB_Transaction_GetLocalName(t);                                                        \n
               $(struct_prefix)_SetOwner(st, s);                                                        \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetByBankCodeAndAccountNumber($(struct_type)_LIST *l, 
                                                                                                   const char *bankCode,
                                                                                                   const char *accountNumber,
                                                                                                   int accountType);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetByBankCodeAndAccountNumber($(struct_type)_LIST *l,       \n
                                                                                            const char *bankCode,         \n
                                                                                            const char *accountNumber,    \n
                                                                                            int accountType) {            \n
               AB_IMEXPORTER_ACCOUNTINFO *iea;                                                                            \n
                                                                                                                          \n
               assert(l);                                                                                                 \n
                                                                                                                          \n
               if (!bankCode)                                                                                             \n
                 bankCode="";                                                                                             \n
               if (!accountNumber)                                                                                        \n
                 accountNumber="";                                                                                        \n
                                                                                                                          \n
               iea=$(struct_prefix)_List_First(l);                                                                        \n
               while(iea) {                                                                                               \n
                 const char *sBankCode;                                                                                   \n
                 const char *sAccountNumber;                                                                              \n
                                                                                                                          \n
                 sBankCode=$(struct_prefix)_GetBankCode(iea);                                                             \n
                 if (sBankCode==NULL)                                                                                     \n
                   sBankCode="";                                                                                          \n
                 sAccountNumber=$(struct_prefix)_GetAccountNumber(iea);                                                   \n
                 if (sAccountNumber==NULL)                                                                                \n
                   sAccountNumber="";                                                                                     \n
                                                                                                                          \n
                 if ((strcasecmp(sBankCode, bankCode)==0) &amp;&amp;                                                      \n
                     (strcasecmp(sAccountNumber, accountNumber)==0) &amp;&amp;                                            \n
                     ((accountType&lt;=AB_AccountType_Unknown) || (accountType==$(struct_prefix)_GetAccountType(iea)))    \n
                    )                                                                                                     \n
                   return iea;                                                                                            \n
                                                                                                                          \n
                 iea=$(struct_prefix)_List_Next(iea);                                                                     \n
               }                                                                                                          \n
                                                                                                                          \n
               return NULL;                                                                                               \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_Find($(struct_type)_LIST *l,
                                                                          uint32_t uniqueId,
                                                                          const char *iban,
                                                                          const char *bankCode,
                                                                          const char *accountNumber,
                                                                          int accountType);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_Find($(struct_type)_LIST *l,                               \n
                                                                   uint32_t uniqueId,                                    \n
                                                                   const char *iban,                                     \n
                                                                   const char *bankCode,                                 \n
                                                                   const char *accountNumber,                            \n
                                                                   int accountType) {                                    \n
               AB_IMEXPORTER_ACCOUNTINFO *iea=NULL;                                                                      \n
                                                                                                                         \n
               assert(l);                                                                                                \n
                                                                                                                         \n
               if (uniqueId)                                                                                             \n
                 iea=$(struct_prefix)_List_GetByAccountId(l, uniqueId);                                                  \n
                                                                                                                         \n
               if (iea==NULL &amp;&amp; iban &amp;&amp; *iban)                                                           \n
                 $(struct_prefix)_List_GetByIban(l, iban);                                                               \n
                                                                                                                         \n
               if (iea==NULL)                                                                                            \n
                 iea=$(struct_prefix)_List_GetByBankCodeAndAccountNumber(l, bankCode, accountNumber, accountType);       \n
                                                                                                                         \n
               return iea;                                                                                               \n
             }                                                                                                           
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetByAccountSpec($(struct_type)_LIST *l, const AB_ACCOUNT_SPEC *a);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetByAccountSpec($(struct_type)_LIST *l, const AB_ACCOUNT_SPEC *a) { \n
               assert(l);                                                                                                          \n
               assert(a);                                                                                                          \n
                                                                                                                                   \n
               return $(struct_prefix)_List_Find(l,                                                                                \n
                                                 AB_AccountSpec_GetUniqueId(a),                                                    \n
                                                 AB_AccountSpec_GetIban(a),                                                        \n
                                                 AB_AccountSpec_GetBankCode(a),                                                    \n
                                                 AB_AccountSpec_GetAccountNumber(a),                                               \n
                                                 AB_AccountSpec_GetType(a));                                                       \n
             }
          </content>
        </inline>



        <inline loc="end" access="public">
          <content>
             $(api) AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetOrAddByAccountSpec($(struct_type)_LIST *l, const AB_ACCOUNT_SPEC *a);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetOrAddByAccountSpec($(struct_type)_LIST *l, const AB_ACCOUNT_SPEC *a) {\n
               AB_IMEXPORTER_ACCOUNTINFO *iea=NULL;                                                                                    \n
                                                                                                                                       \n
               assert(l);                                                                                                              \n
                                                                                                                                       \n
               iea=$(struct_prefix)_List_GetByAccountSpec(l, a);                                                                       \n
               if (iea==NULL) {                                                                                                        \n
                 iea=$(struct_prefix)_new();                                                                                           \n
                 $(struct_prefix)_FillFromAccountSpec(iea, a);                                                                         \n
                 $(struct_prefix)_List_Add(iea, l);                                                                                    \n
               }                                                                                                                       \n
               return iea;                                                                                                             \n
             }
          </content>
        </inline>


        <inline loc="end" access="public">
          <content>
             $(api) AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetOrAdd($(struct_type)_LIST *l,
                                                                              uint32_t uniqueId,
                                                                              const char *iban,
                                                                              const char *bankCode,
                                                                              const char *accountNumber,
                                                                              int accountType);
          </content>
        </inline>

        <inline loc="code">
          <content>
             AB_IMEXPORTER_ACCOUNTINFO *$(struct_prefix)_List_GetOrAdd($(struct_type)_LIST *l,                            \n
                                                                       uint32_t uniqueId,                                 \n
                                                                       const char *iban,                                  \n
                                                                       const char *bankCode,                              \n
                                                                       const char *accountNumber,                         \n
                                                                       int accountType) {                                 \n
               AB_IMEXPORTER_ACCOUNTINFO *iea=NULL;                                                                       \n
                                                                                                                          \n
               assert(l);                                                                                                 \n
                                                                                                                          \n
               iea=$(struct_prefix)_List_Find(l, uniqueId, iban, bankCode, accountNumber, accountType);                   \n
               if (iea==NULL) {                                                                                           \n
                 iea=$(struct_prefix)_new();                                                                              \n
                 $(struct_prefix)_SetAccountId(iea, uniqueId);                                                            \n
                 $(struct_prefix)_SetIban(iea, iban);                                                                     \n
                 $(struct_prefix)_SetBankCode(iea, bankCode);                                                             \n
                 $(struct_prefix)_SetAccountNumber(iea, accountNumber);                                                   \n
                 $(struct_prefix)_SetAccountType(iea, accountType);                                                       \n
                                                                                                                          \n
                 $(struct_prefix)_List_Add(iea, l);                                                                       \n
               }                                                                                                          \n
               return iea;                                                                                                \n
             }
          </content>
        </inline>



      </inlines>


    </lang>

    <enums>

    </enums>

    <defines>

    </defines>


    <members>

      <member name="bankCode" type="char_ptr" maxlen="16" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="bankName" type="char_ptr" maxlen="64" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="accountNumber" type="char_ptr" maxlen="32" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="subAccountId" type="char_ptr" maxlen="32" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="accountName" type="char_ptr" maxlen="64" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="iban" type="char_ptr" maxlen="32" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash with_getbyMember</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="bic" type="char_ptr" maxlen="32" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="owner" type="char_ptr" maxlen="64" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="currency" type="char_ptr" maxlen="16" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="description" type="char_ptr" maxlen="64" >
        <descr>
        </descr>
        <access>public</access>
        <flags>own with_hash</flags>
        <setflags>const dup</setflags>
        <getflags>const</getflags>
      </member>

      <member name="accountType" type="int" maxlen="4" >
        <default>0</default>
        <preset>0</preset>
        <access>public</access>
        <flags>with_hash</flags>
        <setflags>none</setflags>
        <getflags>none</getflags>
      </member>

      <member name="accountId" type="uint32_t" maxlen="4">
        <flags>with_hash with_getbyMember</flags>
        <default>0</default>
        <preset>0</preset>
        <access>public</access>
        <descr>
        </descr>
      </member>

      <member name="accountStatusList" type="AB_ACCOUNT_STATUS_LIST" elementName="status">
        <descr>
        </descr>
        <default>NULL</default>
        <preset>AB_AccountStatus_List_new()</preset>
        <access>public</access>
        <flags>own</flags>
        <setflags>nodup</setflags>
        <getflags>none</getflags>
      </member>


      <member name="transactionList" type="AB_TRANSACTION_LIST" elementName="transaction">
        <descr>
          List of transactions.
          This list contains any kind of transactions all in one list. You can differentiate the type
          of the transaction (e.g. bank statement, debit note, transfer etc) by looking at the transaction type
          (see @ref AB_Transaction_GetType).
        </descr>
        <default>NULL</default>
        <preset>AB_Transaction_List_new()</preset>
        <access>public</access>
        <flags>own</flags>
        <setflags>nodup</setflags>
        <getflags>none</getflags>
      </member>

      <member name="eStatementList" type="AB_DOCUMENT_LIST" elementName="eStatement">
        <descr>
        </descr>
        <default>NULL</default>
        <preset>AB_Document_List_new()</preset>
        <access>public</access>
        <flags>own</flags>
        <setflags>nodup</setflags>
        <getflags>none</getflags>
      </member>

    </members>

    
  </type>
  
</tm2>

